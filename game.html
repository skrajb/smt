<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Typing Arena | Competitive</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:system-ui;background:#f8fafc;display:flex;justify-content:center;align-items:center;min-height:100vh}
.app{width:95%;max-width:980px;background:#fff;padding:22px;border-radius:16px;border:1px solid #e5e7eb}
.header{display:flex;justify-content:space-between;align-items:center}
.stats{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:15px 0}
.stat{border:1px solid #e5e7eb;border-radius:10px;padding:10px;text-align:center}
.stat small{color:#64748b}
.text{font-family:monospace;font-size:20px;line-height:1.8;min-height:100px}
.correct{color:#16a34a}
.wrong{color:#dc2626}
.active{color:#2563eb;font-weight:600}
.pending{color:#64748b}
input{width:100%;padding:14px;font-size:16px;border-radius:10px;border:2px solid #e5e7eb}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid #e5e7eb;text-align:center}
</style>
</head>

<body>
<div class="app">

<div class="header">
  <h2>Typing Arena</h2>
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
  </select>
</div>

<div class="stats">
  <div class="stat"><small>Time</small><strong id="time">60</strong></div>
  <div class="stat"><small>WPM</small><strong id="wpm">0</strong></div>
  <div class="stat"><small>Accuracy</small><strong id="accuracy">100%</strong></div>
  <div class="stat"><small>Score</small><strong id="score">0</strong></div>
  <div class="stat"><small>Streak</small><strong id="streak">0</strong></div>
</div>

<div class="text" id="textBox"></div>
<input id="input" placeholder="Type and press space" autofocus>

<h3>üèÜ Leaderboard</h3>
<table>
<thead><tr><th>#</th><th>Name</th><th>WPM</th><th>Accuracy</th></tr></thead>
<tbody id="leaderboard"></tbody>
</table>

</div>

<script type="module">
import { saveScore, loadLeaderboard } from "./firebase.js";

const WORDS=["typing","keyboard","accuracy","education","computer","practice","developer","internet","speed","focus"];

const textBox=inputBox=document.getElementById("textBox");
const input=document.getElementById("input");
const timeEl=document.getElementById("time");
const wpmEl=document.getElementById("wpm");
const accEl=document.getElementById("accuracy");
const scoreEl=document.getElementById("score");
const streakEl=document.getElementById("streak");
const lb=document.getElementById("leaderboard");
const difficulty=document.getElementById("difficulty");

let words=[],status=[],i=0,time=60,timer=null,start=null;
let correct=0,total=0,score=0,streak=0;

function generate(){
  words=[];status=[];i=0;
  while(words.length<20) words.push(WORDS[Math.floor(Math.random()*WORDS.length)]);
  render();
}

function render(){
  textBox.innerHTML=words.map((w,idx)=>{
    if(status[idx]==="c") return `<span class="correct">${w}</span> `;
    if(status[idx]==="w") return `<span class="wrong">${w}</span> `;
    if(idx===i) return `<span class="active">${w}</span> `;
    return `<span class="pending">${w}</span> `;
  }).join("");
}

function startTimer(){
  if(timer) return;
  start=Date.now();
  timer=setInterval(()=>{
    time--; timeEl.textContent=time;
    if(time<=0) endGame();
  },1000);
}

input.addEventListener("input",()=>{
  startTimer(); total++;
  if(input.value.endsWith(" ")){
    const typed=input.value.trim();
    if(typed===words[i]){
      status[i]="c"; correct+=typed.length+1; score+=10; streak++;
    }else{
      status[i]="w"; streak=0;
    }
    i++; input.value="";
    if(i>=words.length) generate();
    update(); render();
  }
});

function update(){
  const mins=((Date.now()-start)/1000)/60||1/60;
  wpmEl.textContent=Math.round((correct/5)/mins);
  accEl.textContent=Math.round((correct/total)*100)+"%";
  scoreEl.textContent=score;
  streakEl.textContent=streak;
}

async function endGame(){
  clearInterval(timer); input.disabled=true;
  const name=prompt("Your name")||"Guest";
  await saveScore({name,wpm:+wpmEl.textContent,accuracy:+accEl.textContent.replace("%",""),score,difficulty:difficulty.value});
  loadLB();
}

async function loadLB(){
  const data=await loadLeaderboard(difficulty.value);
  lb.innerHTML=data.length
    ? data.map((u,i)=>`<tr><td>${i+1}</td><td>${u.name}</td><td>${u.wpm}</td><td>${u.accuracy}%</td></tr>`).join("")
    : `<tr><td colspan="4">No data</td></tr>`;
}

difficulty.addEventListener("change",()=>location.reload());

generate();
loadLB();
</script>

</body>
</html>
