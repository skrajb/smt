<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Typing Arena | Competitive</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto;
    background:#f8fafc;
    color:#0f172a;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}
.app{
    width:95%;
    max-width:980px;
    background:#ffffff;
    border:1px solid #e5e7eb;
    border-radius:16px;
    padding:22px;
}
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:16px;
}
.controls{
    display:flex;
    gap:10px;
}
select,button{
    padding:8px 12px;
    border:1px solid #e5e7eb;
    background:#fff;
    border-radius:8px;
    cursor:pointer;
}
.stats{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:12px;
    margin-bottom:16px;
}
.stat{
    padding:12px;
    border:1px solid #e5e7eb;
    border-radius:10px;
    text-align:center;
}
.stat small{
    color:#64748b;
    font-size:12px;
}
.stat strong{
    display:block;
    font-size:18px;
    margin-top:4px;
}
.streak-hot{color:#f97316;}
.streak-fire{
    color:#ef4444;
    text-shadow:0 0 6px rgba(239,68,68,.4);
}
.arena{
    border:1px solid #e5e7eb;
    border-radius:12px;
    padding:16px;
    margin-bottom:16px;
}
.text{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas;
    font-size:20px;
    line-height:1.8;
    min-height:120px;
    margin-bottom:12px;
}
.correct{color:#16a34a;}
.wrong{color:#dc2626;}
.active{color:#2563eb;font-weight:600;}
.pending{color:#64748b;}
input{
    width:100%;
    padding:14px;
    font-size:17px;
    border:2px solid #e5e7eb;
    border-radius:10px;
    outline:none;
}
input:focus{
    border-color:#2563eb;
}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    padding:10px;
    border-bottom:1px solid #e5e7eb;
    text-align:center;
}
th{
    font-size:13px;
    color:#64748b;
}
@media(max-width:800px){
    .stats{grid-template-columns:repeat(2,1fr);}
}
</style>
</head>

<body>

<div class="app">

    <div class="header">
        <h1>Typing Arena ‚Äì Competitive</h1>
        <div class="controls">
            <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
            </select>
            <button onclick="restart()">Restart</button>
        </div>
    </div>

    <div class="stats">
        <div class="stat"><small>Time</small><strong id="time">60</strong></div>
        <div class="stat"><small>WPM</small><strong id="wpm">0</strong></div>
        <div class="stat"><small>Accuracy</small><strong id="accuracy">100%</strong></div>
        <div class="stat"><small>Score</small><strong id="score">0</strong></div>
        <div class="stat"><small>Streak</small><strong id="streak">0</strong></div>
    </div>

    <div class="arena">
        <div class="text" id="textBox"></div>
        <input id="input" placeholder="Type word and press space" autofocus>
    </div>

    <h3>üèÜ Today‚Äôs Leaderboard</h3>
    <table>
        <thead>
            <tr><th>#</th><th>Name</th><th>WPM</th><th>Accuracy</th></tr>
        </thead>
        <tbody id="leaderboard"></tbody>
    </table>

</div>

<script type="module">
import { saveScore, loadLeaderboard } from "./firebase.js";

/* DOM */
const textBox = document.getElementById("textBox");
const input = document.getElementById("input");
const timeEl = document.getElementById("time");
const wpm = document.getElementById("wpm");
const accuracy = document.getElementById("accuracy");
const scoreEl = document.getElementById("score");
const streakEl = document.getElementById("streak");

/* WORDS */
const WORDS = [
 "typing","keyboard","accuracy","performance","education",
 "portal","computer","technology","developer","practice",
 "programming","internet","speed","focus","exam"
];

/* STATE */
let text=[], status=[], index=0;
let time=60, timer=null, startTime=null;
let correctChars=0, totalChars=0;
let score=0, streak=0, multiplier=1;
let minLen=3, maxLen=5, penalty=0;

/* DIFFICULTY */
function applyDifficulty(){
    const d = difficulty.value;
    if(d==="easy"){ time=60; minLen=3; maxLen=5; penalty=0; }
    if(d==="medium"){ time=60; minLen=5; maxLen=8; penalty=1; }
    if(d==="hard"){ time=45; minLen=7; maxLen=12; penalty=2; }
    timeEl.textContent=time;
}

/* GENERATE */
function generate(){
    text=[]; status=[];
    while(text.length<20){
        const w = WORDS[Math.floor(Math.random()*WORDS.length)];
        if(w.length>=minLen && w.length<=maxLen) text.push(w);
    }
    index=0;
    render();
}

/* RENDER */
function render(){
    textBox.innerHTML = text.map((w,i)=>{
        if(status[i]==="correct") return `<span class="correct">${w}</span> `;
        if(status[i]==="wrong") return `<span class="wrong">${w}</span> `;
        if(i===index) return `<span class="active">${w}</span> `;
        return `<span class="pending">${w}</span> `;
    }).join("");
}

/* TIMER */
function startTimer(){
    if(timer) return;
    startTime = Date.now();
    timer = setInterval(()=>{
        time--;
        timeEl.textContent=time;
        if(time<=0) endGame();
    },1000);
}

/* INPUT */
input.addEventListener("input",()=>{
    startTimer();
    totalChars++;

    if(input.value.endsWith(" ")){
        const typed = input.value.trim();
        const current = text[index];

        if(typed === current){
            status[index] = "correct";
            streak++;
            correctChars += current.length + 1;
            multiplier = streak>=20 ? 2 : 1;
            score += 10 * multiplier;
        } else {
            status[index] = "wrong";
            streak = 0;
            multiplier = 1;
            index += penalty;
        }

        updateStreak();
        index++;
        input.value="";

        if(index >= text.length) generate();
        render();
    }
    updateStats();
});

/* STATS */
function updateStats(){
    const mins = ((Date.now()-startTime)/1000)/60 || 1/60;
    wpm.textContent = Math.round((correctChars/5)/mins);
    accuracy.textContent = totalChars
        ? Math.round((correctChars/totalChars)*100)+"%"
        : "100%";
    scoreEl.textContent = score;
}

/* STREAK UI */
function updateStreak(){
    streakEl.textContent = streak;
    streakEl.className="";
    if(streak>=20) streakEl.classList.add("streak-fire");
    else if(streak>=10) streakEl.classList.add("streak-hot");
}

/* END GAME */
async function endGame(){
    clearInterval(timer);
    input.disabled=true;

    const name = prompt("Enter your name");
    if(name){
        await saveScore({
            name,
            wpm:+wpm.textContent,
            accuracy:+accuracy.textContent.replace("%",""),
            score,
            difficulty:difficulty.value
        });
    }
    loadLB();
}

/* LEADERBOARD */
async function loadLB(){
    const data = await loadLeaderboard();
    leaderboard.innerHTML = data.map((u,i)=>`
        <tr>
            <td>${i+1}</td>
            <td>${u.name}</td>
            <td>${u.wpm}</td>
            <td>${u.accuracy}%</td>
        </tr>
    `).join("");
}

/* RESET */
function restart(){
    clearInterval(timer);
    timer=null;
    startTime=null;
    correctChars=totalChars=score=streak=0;
    input.disabled=false;
    input.value="";
    applyDifficulty();
    generate();
}

/* INIT */
applyDifficulty();
generate();
loadLB();
</script>

</body>
</html>
