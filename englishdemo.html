<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Smartech Education - English Demo Test</title>

<!-- Shared Theme -->
<link rel="stylesheet" href="styles.css">

</head>
<body autocomplete="off" spellcheck="false">

<!-- HEADER -->
<div id="header-container"></div>
<script>
fetch("header.html")
  .then(r => r.text())
  .then(d => document.getElementById("header-container").innerHTML = d);
</script>

<!-- ================= TEST CONTAINER ================= -->
<main class="container">

  <center><h2>English Demo Test</h2></center>

  <section class="test-section" id="test-section">

    <!-- TOP BAR -->
    <div class="top-bar">
      <div class="left-meta"></div>
      <div class="center-meta">
        <div id="timer">Time: 02:00</div>
      </div>
      <div class="right-meta"></div>
    </div>

    <!-- CHUNK INFO -->
    <div id="current-chunk">Current Chunk - 1</div>

    <!-- TEST AREA -->
    <div id="test-area">

      <!-- REFERENCE TEXT -->
      <div class="reference-outer">
        <div id="paragraph" class="paragraph">Loading...</div>
      </div>

      <!-- TYPING AREA -->
      <textarea
        id="typing-input"
        class="typing-input"
        placeholder="Start typing here..."
        rows="4"
        autocomplete="off"
        autocorrect="off"
        autocapitalize="off"
        spellcheck="false"
        autofocus></textarea>

      <!-- SUBMIT -->
      <div style="text-align:right;">
        <button id="submit-btn" class="primary-btn">Submit Test</button>
      </div>

    </div>
  </section>
</main>

<!-- ================= RESULTS ================= -->
<section id="results" style="display:none;">
  <h2>Results</h2>

  <table id="results-table" style="display:none;">
    <thead>
      <tr><th>Metric</th><th>Value</th></tr>
    </thead>
    <tbody>
      <tr><td>Gross Characters</td><td id="gross-characters-value"></td></tr>
      <tr><td>Wrong / Extra / Skipped Words</td><td id="wrong-extra-words-value"></td></tr>
      <tr><td>Space Errors</td><td id="space-errors-value"></td></tr>
      <tr><td>Error Characters</td><td id="error-characters-value"></td></tr>
      <tr><td>Net Characters</td><td id="net-characters-value"></td></tr>
      <tr><td>Gross Speed</td><td id="gross-speed-value"></td></tr>
      <tr><td>Actual Gross Speed</td><td id="actual-gross-speed-value"></td></tr>
      <tr><td>Time Taken</td><td id="time-spent-value"></td></tr>
      <tr><td>Accuracy</td><td id="accuracy-percentage-value"></td></tr>
      <tr><td>Backspace Count</td><td id="backspace-count-value"></td></tr>
      <tr><td>Result</td><td id="result-value"></td></tr>

      <tr id="notes-section" style="display:none;">
        <td colspan="2">
          <div id="results-notes">
            <div id="exam-note"></div>
            <div id="pass-note"></div>
          </div>
        </td>
      </tr>

      <tr id="button-row" style="display:none;">
        <td colspan="2" style="text-align:center;">
          <button id="practice-another-btn-2" class="primary-btn">
            Practice Another
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div id="error-section" style="display:none;">
    <div id="error-highlight"></div>
  </div>

  <div id="saved-stats-container"></div>
</section>

<!-- ================= POPUPS ================= -->
<div id="time-over-popup" class="popup">
  <div class="popup-inner">
    <p>Time is over. View results?</p>
    <button id="popup-ok-btn" class="primary-btn">Yes</button>
  </div>
</div>

<div id="no-input-popup" class="popup">
  <div class="popup-inner">
    <p>No typed input detected.</p>
    <button id="no-input-ok-btn" class="primary-btn">OK</button>
  </div>
</div>

<!-- ================= DEMO TEXT ================= -->
<script>
const demoText = `
The Smartech typing practice paragraph is designed to test speed, accuracy, and focus.
A quick brown fox jumps over the lazy dog to include every alphabet letter.
Candidates practice numbers like 0 1 2 3 4 5 6 7 8 9 for accuracy.
Consistent practice improves typing confidence and examination performance.
`;

localStorage.setItem("selectedExerciseText", demoText.trim());
localStorage.setItem("userName", "Demo User");
localStorage.setItem("userRefNo", "0000");
</script>

<!-- ================= CORE ENGINE ================= -->
<script src="script.js"></script>

<!-- ================= SAFE TIMER START ON FIRST TYPE ================= -->
<script>
let testStarted = false;
let timerInterval = null;
let totalSeconds = 120;

const timerEl = document.getElementById("timer");
const typingInput = document.getElementById("typing-input");
const submitBtn = document.getElementById("submit-btn");

function updateTimer(sec) {
  const m = String(Math.floor(sec / 60)).padStart(2, "0");
  const s = String(sec % 60).padStart(2, "0");
  timerEl.textContent = `Time: ${m}:${s}`;
}

function startTimer() {
  if (testStarted) return;
  testStarted = true;

  timerInterval = setInterval(() => {
    totalSeconds--;
    updateTimer(totalSeconds);

    if (totalSeconds <= 0) {
      clearInterval(timerInterval);
      endTest();
    }
  }, 1000);
}

function endTest() {
  if (typeof submitResults === "function") {
    submitResults();
  } else {
    document.getElementById("time-over-popup").style.display = "flex";
  }
}

typingInput.addEventListener("keydown", e => {
  if (!testStarted && e.key.length === 1) {
    startTimer();
  }
});

submitBtn.addEventListener("click", () => {
  clearInterval(timerInterval);
});

updateTimer(totalSeconds);
</script>

</body>
</html>
